<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Contractors | ProCrafted Homes</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="fade-down">
  <div class="logo">
  <img src="images/logo.png" alt="ProCrafted Homes Logo">
</div>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="services.html">Services</a></li>
    <li><a href="contractors.html" style="color:var(--secondary)">Contractors</a></li>
    <li><a href="projects.html">Projects</a></li>
    <li><a href="tools.html">Tools</a></li>
    <li><a href="about.html">About</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
</nav>

<section class="contractors-section fade-up">
  <h2 class="reveal">Find Trusted Contractors</h2>

  <div class="filter-bar fade-up">
    <input id="searchBar" placeholder="Search by name, skill, or city">
    <select id="cityFilter">
      <option value="all">All Cities</option>
    </select>
  </div>

  <div id="contractors-list" class="contractor-grid">
    <!-- Contractors load dynamically -->
  </div>
</section>

<footer class="fade-up">
  © 2025 ProCrafted Homes | Premium Construction & Design Solutions
</footer>

<!-- Contractor Data Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

  const USE_FIREBASE = false;

  const firebaseConfig = {
    apiKey: "AIzaSyBeccwySrja43f_q1nGjxekdxIq9ecsEvo",
    authDomain: "procrafted-homes.firebaseapp.com",
    databaseURL: "https://procrafted-homes-default-rtdb.firebaseio.com",
    projectId: "procrafted-homes",
    storageBucket: "procrafted-homes.firebasestorage.app",
    messagingSenderId: "496370643233",
    appId: "1:496370643233:web:586bde30180cb3652f4e60"
  };

  // RENDER CONTRACTORS
 function populateContractors(contractors) {
  const list = document.getElementById("contractors-list");
  if (!list) {
    console.error("Container #contractors-list not found in DOM!");
    return;
  }

  const cityFilter = document.getElementById("cityFilter");
  const searchBar = document.getElementById("searchBar");

  // Debug check
  console.log("Rendering contractors:", contractors.length);

  // Clear previous content
  list.innerHTML = "";

  // Populate unique cities
  const uniqueCities = [...new Set(contractors.map(c => c.location.split(",")[0].trim()))];
  cityFilter.innerHTML = '<option value="all">All Cities</option>';
  uniqueCities.forEach(city => {
    const opt = document.createElement("option");
    opt.value = city;
    opt.textContent = city;
    cityFilter.appendChild(opt);
  });

  // Render function
  function display(filtered) {
    list.innerHTML = "";
    if (!filtered || filtered.length === 0) {
      list.innerHTML = "<p style='text-align:center;'>No contractors found.</p>";
      return;
    }

    filtered.forEach((c, i) => {
      const card = document.createElement("div");
      card.className = "contractor-card fade-up visible";
      card.style.animationDelay = `${i * 100}ms`;
      card.innerHTML = `
        <img src="${c.image || 'images/default-contractor.jpg'}" alt="${c.name}" style="width:100%; height:200px; object-fit:cover; border-radius:8px 8px 0 0;">
        <div class="contractor-info" style="padding:15px;">
          <h3>${c.name}</h3>
          <p><strong>City:</strong> ${c.location}</p>
          <p><strong>Expertise:</strong> ${c.specialization}</p>
          <p><strong>Rating:</strong> ⭐ ${c.rating}</p>
          <p><strong>Price:</strong> ${c.priceRange}</p>
        </div>
      `;
      list.appendChild(card);
    });
  }

  // Initial load
  display(contractors);

  // Filters
  cityFilter.addEventListener("change", () => {
    const city = cityFilter.value;
    const filtered = city === "all"
      ? contractors
      : contractors.filter(c => c.location.includes(city));
    display(filtered);
  });

  searchBar.addEventListener("input", e => {
    const query = e.target.value.toLowerCase();
    const filtered = contractors.filter(
      c =>
        c.name.toLowerCase().includes(query) ||
        c.specialization.toLowerCase().includes(query) ||
        c.location.toLowerCase().includes(query)
    );
    display(filtered);
  });
}


  // FETCH DATA
  if (!USE_FIREBASE) {
    fetch("./contractors.json")
      .then(res => {
        if (!res.ok) throw new Error("File not found or invalid JSON path");
        return res.json();
      })
      .then(data => {
        console.log("✅ Contractors loaded:", data);
        populateContractors(data);
      })
      .catch(err => console.error("❌ Error loading data:", err));
  } else {
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db);

    get(child(dbRef, "contractors"))
      .then(snapshot => {
        if (snapshot.exists()) {
          populateContractors(Object.values(snapshot.val()));
        } else {
          console.warn("⚠️ No contractor data found in Firebase.");
        }
      })
      .catch(error => console.error("❌ Firebase error:", error));
  }
</script>

<!-- ANIMATION SCRIPT -->
<script>
  const elements = document.querySelectorAll(".fade-up, .fade-down, .slide-in-left, .slide-in-right, .zoom-in, .reveal");

  function animateOnScroll() {
    elements.forEach(el => {
      const rect = el.getBoundingClientRect();
      if (rect.top < window.innerHeight - 100) el.classList.add("visible");
    });
  }

  window.addEventListener("scroll", animateOnScroll);
  window.addEventListener("load", animateOnScroll);
</script>

<!-- AI Chat -->
<div id="ai-chat-root">
  <button id="ai-toggle" aria-label="Open AI Chat">AI</button>

  <div id="ai-chat" aria-hidden="true">
    <div class="ai-header">
      <strong>ProCrafted AI</strong>
      <button id="ai-close" aria-label="Close">×</button>
    </div>

    <div id="ai-messages" class="ai-messages" role="log" aria-live="polite"></div>

    <form id="ai-form" class="ai-form">
      <input id="ai-input" autocomplete="off" placeholder="Ask about materials, cost, contractors..." />
      <button type="submit">Send</button>
    </form>
  </div>
</div>

<!-- include the AI JS -->
<script defer src="aiChat.js"></script>
</body>
</html>
